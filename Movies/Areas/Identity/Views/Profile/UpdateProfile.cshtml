@model Movies.ViewModel.ApplicationUserVM

@section Scripts {
    <partial name="_NotificationPartial" />
}

<div class="container my-4">
    <div class="row gutters">
        <!-- ===== Left Profile Card ===== -->
        <div class="col-xl-3 col-lg-4 col-md-12 mb-3">
            <div class="card h-100 shadow-sm border-0 text-center">
                <div class="card-body">
                    <div class="user-profile mb-3">
                        <div class="user-avatar position-relative d-inline-block">
                            <img id="profilePreview"
                                 src="@(string.IsNullOrEmpty(Model.ImgPath)
                                                 ? Url.Content("~/Img/default-user.png")
                                                 : Url.Content("~/Img/" + Model.ImgPath))"
                                 alt="User Avatar"
                                 class="rounded-circle border shadow-sm"
                                 style="width: 120px; height: 120px; object-fit: cover;" />

                            <!-- زر اختيار الصورة -->
                            <label for="ProfileImage" class="btn btn-warning btn-sm position-absolute bottom-0 end-0 rounded-circle"
                                   style="width:35px; height:35px; display:flex; align-items:center; justify-content:center; border:2px solid #fff;">
                                <i class="bi bi-camera-fill text-dark"></i>
                            </label>
                        </div>

                        <!-- رفع الصورة -->
                        <form asp-action="UploadProfileImage" method="post" enctype="multipart/form-data" class="mt-3">
                            <input type="file" id="ProfileImage" name="ProfileImage" accept="image/*" class="d-none" onchange="previewProfileImage(event)" />
                            <button type="submit" class="btn btn-warning mt-2 px-4 fw-semibold text-dark shadow-sm">
                                Upload
                            </button>
                        </form>
                    </div>

                  

                    <h5 class="fw-bold mb-1">@Model.FullName</h5>
                    <h6 class="text-muted mb-3">@Model.Email</h6>

                    <div class="about text-start px-3">
                        <h6 class="text-primary fw-semibold">About</h6>
                        <p class="text-muted small mb-0">
                            I'm Yuki — a Full Stack Designer who enjoys creating user-centric and delightful experiences.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== Right Forms Section ===== -->
        <div class="col-xl-9 col-lg-8 col-md-12">
            <!-- === Update Profile Form === -->
            <form asp-action="UpdateProfile" method="post">
                <div class="card mb-4 shadow-sm border-0">
                    <div class="card-body">
                        <h5 class="text-primary mb-3">Personal Details</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="FullName" class="form-label">Full Name</label>
                                <input asp-for="FullName" class="form-control" placeholder="Enter full name" />
                                <span asp-validation-for="FullName" class="text-danger small"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Email" class="form-label">Email</label>
                                <input asp-for="Email" class="form-control" disabled />
                            </div>

                            <div class="col-md-6">
                                <label asp-for="PhoneNumber" class="form-label">Phone</label>
                                <input asp-for="PhoneNumber" class="form-control" placeholder="Enter phone number" />
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Address" class="form-label">Address</label>
                                <input asp-for="Address" class="form-control" placeholder="Enter address" />
                            </div>
                        </div>

                        <div class="text-end mt-4">
                            <button type="reset" class="btn btn-outline-secondary me-2">Cancel</button>
                            <button type="submit" class="btn btn-warning text-dark fw-semibold shadow-sm">Update</button>
                        </div>
                    </div>
                </div>
            </form>

            <!-- === Update Password Form === -->
            <form asp-action="UpdatePassword" method="post">
                <div class="card shadow-sm border-0">
                    <div class="card-body">
                        <h5 class="text-primary mb-3">Update Password</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="CurrentPassword" class="form-label">Current Password</label>
                                <input asp-for="CurrentPassword" class="form-control" type="password" placeholder="Enter current password" />
                                <span asp-validation-for="CurrentPassword" class="text-danger small"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="NewPassword" class="form-label">New Password</label>
                                <input asp-for="NewPassword" class="form-control" type="password" placeholder="Enter new password" />
                                <span asp-validation-for="NewPassword" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="text-end mt-4">
                            <button type="submit" class="btn btn-warning text-dark fw-semibold shadow-sm">Update Password</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- === JavaScript for image preview === -->
<script>
    function previewProfileImage(event) {
        const preview = document.getElementById("profilePreview");
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }
</script>
